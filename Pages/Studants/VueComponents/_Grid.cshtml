<style>
  .vue-grid {
    display: flex;
    flex-direction: column;
  }
</style>

<script type="text/javascript">
    Vue.component('vue-studant-grid', {
        data() {
            return {
              fields: [{
                key: 'id',
                label: 'Code',
                sortable: true,
              },
              {
                key: 'name',
                label: 'Name',
                sortable: true,
              },
              {
                key: 'averageScore',
                label: 'Average Score',
                sortable: true,
              }],
              items: [],
              path: '/Studants',
              isBusy: false,
              filter: {
                skip: 0,
                take: 100
              }
            }
        },
        template: '#vue-studants-grid-template',
        methods: {
          onSelect(lines) {
            if (lines.length > 0) {
              this.$emit('select', lines[0])
            }
          },
          isBusyToggle () {
            this.isBusy = !this.isBusy
          },
          load() {
            loadExternalData(this)
          }
        },
        mounted() {
          this.load()
        },
    });

    function loadExternalData(component) {
      component.isBusyToggle();
      return AjaxGet(
          component.path,
          'List',
          component.filter)
        .done((data) => {
            component.items = data
        })
        .fail((failure) => {
            console.log('Falha ao obtar dados do servidor', failure)
        })
        .always(() => {
          component.isBusyToggle()
        })
    }
</script>

<script type="text/template" id="vue-studants-grid-template">
  <div class="vue-grid">
    <slot></slot>
    <b-table 
      class="mt-3"
      :items="items" 
      :busy="isBusy" 
      :fields="fields" 
      :hover="true"
      :selectable="true"
      :select-mode="'single'"
      @@row-selected="onSelect"
      outlined>
      <template #table-busy>
        <div class="text-center text-danger my-2">
          <b-spinner class="align-middle"></b-spinner>
          <strong>Loading...</strong>
        </div>
      </template>
    </b-table>
  </div>
</script>